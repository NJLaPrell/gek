<div class="modal-header">
    <h4 class="modal-title">Sort Rules</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="activeModal.dismiss('Cross click')"></button>
</div>
<div class="modal-body">
    <form>
    <table class="table table-striped table-hover table-sm" style="table-layout:fixed;">
        <thead>
            <tr>
                <th>&nbsp;</th>
                <th>Type</th>
                <th>Channel Match</th>
                <th>Title Match</th>
                <th>DescriptionMatch</th>
                <th>Playlist</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let r of rules">
                <ng-template [ngIf]="!r.edit">
                    <td><fa-icon [icon]="faEdit" class="icon-button text-primary" (click)="r.edit = true" ngbTooltip="Edit Rule"></fa-icon> &nbsp;<fa-icon [icon]="faTrash" ngbTooltip="Delete Rule" class="text-danger icon-button"></fa-icon></td>
                    <td>{{ r.type }}</td>
                    <td [class.text-center]="!r.channelMatch">{{ subTitleById(r.channelMatch) || '---' }}</td>
                    <td [class.text-center]="!r.titleMatch">{{ r.titleMatch || '---'}}</td>
                    <td [class.text-center]="!r.descriptionMatch">{{ r.descriptionMatch || '---'}}</td>
                    <td>{{ playlistTitleById(r.playlistId) }}</td>
                </ng-template>

                <ng-template [ngIf]="r.edit">
                    <td><fa-icon [icon]="faCircleCheck" class="icon-button text-success" (click)="updateRule(r)" ngbTooltip="Save Updates"></fa-icon> &nbsp; <fa-icon [icon]="faXmarkCircle" ngbTooltip="Cancel Edit" class="icon-button text-secondary" (click)="r.edit = false"></fa-icon></td>
                    <td>
                        <div ngbDropdown class="d-inline-block">
                            <button type="button" class="btn btn-outline-primary" id="ruleType" ngbDropdownToggle>{{ r.type || 'Select a Type' }}</button>
                            <div ngbDropdownMenu aria-labelledby="ruleType">
                                <button *ngIf="r.type !== 'and'" (click)="r.type = 'and'" ngbDropdownItem>and</button>
                                <button *ngIf="r.type !== 'or'" (click)="r.type = 'or'" ngbDropdownItem>or</button>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div ngbDropdown class="d-inline-block">
                            <button type="button" class="btn btn-outline-primary" id="channelMatch" ngbDropdownToggle>{{ subTitleById(r.channelMatch) || '-- None --' }}</button>
                            <div ngbDropdownMenu aria-labelledby="channelMatch" style="max-height: 200px; overflow:auto">
                                <button (click)="r.channelMatch = ''" class="fs-italics" ngbDropdownItem>None</button>
                                <ng-container *ngFor="let sub of subscriptions">
                                    <button *ngIf="r.channelMatch !== subscriptionsList[sub]" (click)="r.channelMatch = subscriptionsList[sub]" ngbDropdownItem>{{ sub }}</button>
                                </ng-container>
                            </div>
                        </div>
                    </td>
                    <td><input name="name" type="text" class="form-control" placeholder="Title Pattern Match" [(ngModel)]="r.titleMatch" /></td>
                    <td><input name="name" type="text" class="form-control" placeholder="Description Pattern Match" [(ngModel)]="r.descriptionMatch" /></td>
                    <td>
                        <div ngbDropdown class="d-inline-block">
                            <button type="button" class="btn btn-outline-primary" id="playlistId" ngbDropdownToggle>{{ playlistTitleById(r.playlistId) || '(Select a Playlist)' }}</button>
                            <div ngbDropdownMenu aria-labelledby="playlistId" style="max-height: 200px; overflow:auto">
                                <ng-container *ngFor="let pl of playlists">
                                    <button *ngIf="r.playlistId !== playlistsList[pl]" (click)="r.playlistId = playlistsList[pl]" ngbDropdownItem>{{ pl }}</button>
                                </ng-container>
                            </div>
                        </div>
                    </td>
                </ng-template>
            </tr>
        </tbody>
    </table>
</form>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="addRule()"><fa-icon [icon]="faSquarePlus"></fa-icon> Add Rule</button>
    <button type="button" class="btn btn-primary" (click)="activeModal.close('Close click')">Close</button>
</div>